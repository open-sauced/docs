"use strict";(self.webpackChunk_open_sauced_docs_opensauced_pizza=self.webpackChunk_open_sauced_docs_opensauced_pizza||[]).push([[322],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(t),d=i,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||o;return t?a.createElement(h,r(r({ref:n},p),{},{components:t})):a.createElement(h,r({ref:n},p))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<o;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8064:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return m}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],s={id:"semantic-release",title:"@open-sauced/semantic-release-conventional-config",sidebar_label:"@open-sauced/semantic-release-conventional-config",keywords:["@open-sauced/semantic-release-conventional-config"]},l=void 0,c={unversionedId:"maintainers/semantic-release",id:"maintainers/semantic-release",isDocsHomePage:!1,title:"@open-sauced/semantic-release-conventional-config",description:"Description",source:"@site/docs/maintainers/semantic-release.md",sourceDirName:"maintainers",slug:"/maintainers/semantic-release",permalink:"/maintainers/semantic-release",editUrl:"https://github.com/open-sauced/docs.opensauced.pizza/edit/main/docs/maintainers/semantic-release.md",tags:[],version:"current",lastUpdatedBy:"Brian Douglas",lastUpdatedAt:1679659656,formattedLastUpdatedAt:"3/24/2023",frontMatter:{id:"semantic-release",title:"@open-sauced/semantic-release-conventional-config",sidebar_label:"@open-sauced/semantic-release-conventional-config",keywords:["@open-sauced/semantic-release-conventional-config"]},sidebar:"docs",previous:{title:"@open-sauced/conventional-commit",permalink:"/maintainers/conventional-commit"}},p=[{value:"Description",id:"description",children:[],level:2},{value:"Dependencies",id:"dependencies",children:[],level:2},{value:"\ud83d\udda5\ufe0f Requirements",id:"\ufe0f-requirements",children:[],level:2},{value:"\ud83e\uddea GitHub actions usage",id:"-github-actions-usage",children:[],level:2},{value:"\ud83d\udce6 NPM usage",id:"-npm-usage",children:[],level:2},{value:"\ud83d\udd27 Configuration",id:"-configuration",children:[{value:"NPM",id:"npm",children:[],level:3},{value:"GitHub Actions",id:"github-actions",children:[],level:3},{value:"Docker",id:"docker",children:[],level:3},{value:"Environment variables",id:"environment-variables",children:[],level:3}],level:2},{value:"Workflow examples",id:"workflow-examples",children:[{value:"Node application",id:"node-application",children:[],level:3},{value:"Npm library",id:"npm-library",children:[],level:3},{value:"Docker image",id:"docker-image",children:[],level:3},{value:"Pre-releases",id:"pre-releases",children:[],level:3}],level:2},{value:"FAQ",id:"faq",children:[{value:"Which assets are pushed to git",id:"which-assets-are-pushed-to-git",children:[],level:3},{value:"What is the commit convention",id:"what-is-the-commit-convention",children:[],level:3},{value:"How to enrich the static distribution",id:"how-to-enrich-the-static-distribution",children:[],level:3},{value:"How to start using pre-releases",id:"how-to-start-using-pre-releases",children:[],level:3}],level:2},{value:"Contributing",id:"contributing",children:[],level:2}],u={toc:p};function m(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"description"},"Description"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," package ",(0,o.kt)("inlineCode",{parentName:"p"},"@open-sauced/semantic-release-conventional-config")," is designed to help ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," packages auto-release to ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"ghcr")," registries while generating github releases and changelog using conventional commit convention."),(0,o.kt)("p",null,"Version 2 supports alpha and beta pre-releases using coresponding branches."),(0,o.kt)("h2",{id:"dependencies"},"Dependencies"),(0,o.kt)("p",null,"This package uses the following modules:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/commit-analyzer"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/commit-analyzer"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/release-notes-generator"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/release-notes-generator"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/conventional-changelog/conventional-changelog"},(0,o.kt)("inlineCode",{parentName:"a"},"conventional-changelog-conventionalcommits"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/changelog"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/changelog"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/npm"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/npm"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/google/semantic-release-replace-plugin"},(0,o.kt)("inlineCode",{parentName:"a"},"@google/semantic-release-replace-plugin"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/cbhq/semantic-release-license"},(0,o.kt)("inlineCode",{parentName:"a"},"semantic-release-license"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/git"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/git"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/github"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/github"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/eclass/semantic-release-docker"},(0,o.kt)("inlineCode",{parentName:"a"},"@eclass/semantic-release-docker"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/semantic-release/exec"},(0,o.kt)("inlineCode",{parentName:"a"},"@semantic-release/exec"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/sindresorhus/execa"},(0,o.kt)("inlineCode",{parentName:"a"},"execa")))),(0,o.kt)("h2",{id:"\ufe0f-requirements"},"\ud83d\udda5\ufe0f Requirements"),(0,o.kt)("p",null,"Most important limitations are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GITHUB_TOKEN")," for everything"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"NPM_TOKEN")," for public ",(0,o.kt)("inlineCode",{parentName:"li"},"npm")," library"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"docker")," containers need to be built beforehand")),(0,o.kt)("p",null,"You can skip here if you are using elevated ",(0,o.kt)("a",{parentName:"p",href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"Private Access Token"),", however we don't recommend going down that path."),(0,o.kt)("p",null,"No force push or admin cherries branch protections for the following branches:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"main")," - required"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"alpha")," - optional, pre-release branch"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"beta")," - optional, pre-release branch"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"next")," - optional, next channel"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"next-major")," - optional, next major"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"vX[.X.X]")," - maintenance releases")),(0,o.kt)("p",null,"If you use more than the main branch, optionally create an environment that is limiting where pushes can come from and enable the merge strategy."),(0,o.kt)("p",null,"We are using ",(0,o.kt)("inlineCode",{parentName:"p"},"production")," in our examples, if you copy paste them you will find this new environment generated in your settings! \ud83c\udf55"),(0,o.kt)("h2",{id:"-github-actions-usage"},"\ud83e\uddea GitHub actions usage"),(0,o.kt)("p",null,"Since version 3 it is possible to use semantic-release without any trace of it or the open-sauced configuration anywhere in the dependency tree."),(0,o.kt)("p",null,"Docker containers are pushed as part of the release so they mirror the availability of ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," packages."),(0,o.kt)("p",null,"The simplest use case for a typical NPM package, almost zero install downtime from ghcr and no more local tooling:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'name: "Release container"\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  release:\n    environment:\n      name: production\n      url: https://github.com/${{ github.repository }}/releases/tag/${{ env.RELEASE_TAG }}\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: "\ud83d\ude80 release"\n        id: semantic-release\n        uses: docker://ghcr.io/open-sauced/semantic-release-conventional-config:3.0.0\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}\n\n      - name: "\u267b\ufe0f cleanup"\n        run: |\n          echo ${{ env.RELEASE_TAG }}\n          echo ${{ env.RELEASE_VERSION }}\n')),(0,o.kt)("p",null,"Marketplace actions should default to the major tag and are essentially more stable as we have to curate every release."),(0,o.kt)("p",null,"A more traditional approach, only thing really different here is a minor pull overhead and using set outputs instead of environment variables:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'name: "Release"\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  release:\n    environment:\n      name: production\n      url: https://github.com/${{ github.repository }}/releases/tag/${{ steps.semantic-release.outputs.release-tag }}\n    name: Semantic release\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: "\ud83d\ude80 release"\n        id: semantic-release\n        uses: open-sauced/semantic-release-conventional-config@v3\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}\n\n      - name: "\u267b\ufe0f cleanup"\n        run: |\n          echo ${{ steps.semantic-release.outputs.release-tag }}\n          echo ${{ steps.semantic-release.outputs.release-version }}\n')),(0,o.kt)("h2",{id:"-npm-usage"},"\ud83d\udce6 NPM usage"),(0,o.kt)("p",null,"You can opt to use this package in your local tooling. Proceed as you would normally would, replacing ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," with your package manager of choice and install the package:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save-dev @open-sauced/semantic-release-conventional-config\n")),(0,o.kt)("p",null,"The shareable config can then be configured in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/semantic-release/semantic-release/blob/master/docs/usage/configuration.md#configuration"},(0,o.kt)("strong",{parentName:"a"},"semantic-release")," configuration file"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "extends": "@open-sauced/semantic-release-conventional-config"\n}\n')),(0,o.kt)("p",null,"Now all you need to do is create a release:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npx semantic-release\n")),(0,o.kt)("h2",{id:"-configuration"},"\ud83d\udd27 Configuration"),(0,o.kt)("p",null,"See each ",(0,o.kt)("a",{parentName:"p",href:"#-plugins"},"plugin")," documentation for required installation and configuration steps."),(0,o.kt)("h3",{id:"npm"},"NPM"),(0,o.kt)("p",null,"Set ",(0,o.kt)("inlineCode",{parentName:"p"},"private")," to true in ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," if you want to disable ",(0,o.kt)("inlineCode",{parentName:"p"},"npm"),", or, change the scope of package using ",(0,o.kt)("inlineCode",{parentName:"p"},"publishConfig"),"."),(0,o.kt)("p",null,"Keep one of ",(0,o.kt)("inlineCode",{parentName:"p"},"files")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"main")," keys in your ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," accurate depending on whether you are building a library or an application."),(0,o.kt)("p",null,"If you publish, make sure to also provide a valid ",(0,o.kt)("inlineCode",{parentName:"p"},"NPM_TOKEN")," as ",(0,o.kt)("inlineCode",{parentName:"p"},".npmrc")," authentication is ignored in our config!"),(0,o.kt)("h3",{id:"github-actions"},"GitHub Actions"),(0,o.kt)("p",null,"Unless you have an ",(0,o.kt)("inlineCode",{parentName:"p"},"action.yml")," present in your root folder, this module is not added to the release config."),(0,o.kt)("p",null,"If you have an ",(0,o.kt)("inlineCode",{parentName:"p"},"action.yml")," present, our config will attempt to adjust the container version to the newly pushed ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"docker")," tags."),(0,o.kt)("h3",{id:"docker"},"Docker"),(0,o.kt)("p",null,"Unless you have a ",(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile")," present in your root folder, this module is not added to the release config."),(0,o.kt)("p",null,"If you have a ",(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile")," present, our config will attempt to push to ",(0,o.kt)("inlineCode",{parentName:"p"},"ghcr.io"),"."),(0,o.kt)("h3",{id:"environment-variables"},"Environment variables"),(0,o.kt)("p",null,"Using our configuration comes with some sensible defaults:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"DOCKER_USERNAME=$GITHUB_REPOSITORY_OWNER")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"DOCKER_PASSWORD=$GITHUB_TOKEN")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'GIT_COMMITTER_NAME="open-sauced[bot]"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'GIT_COMMITTER_EMAIL="63161813+open-sauced[bot]@users.noreply.github.com"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GIT_AUTHOR_NAME")," - parsed from commit ",(0,o.kt)("inlineCode",{parentName:"li"},"$GITHUB_SHA")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GIT_AUTHOR_EMAIL")," - parsed from commit ",(0,o.kt)("inlineCode",{parentName:"li"},"$GITHUB_SHA"))),(0,o.kt)("p",null,"Feel free to change any of the above to whatever suits your purpose, our motivation is to keep ",(0,o.kt)("inlineCode",{parentName:"p"},"GITHUB_TOKEN")," and/or ",(0,o.kt)("inlineCode",{parentName:"p"},"NPM_TOKEN")," the only necessary requirements."),(0,o.kt)("p",null,"We are actively investigating ways to drop the 2 remaining variables as well!"),(0,o.kt)("h2",{id:"workflow-examples"},"Workflow examples"),(0,o.kt)("h3",{id:"node-application"},"Node application"),(0,o.kt)("p",null,"This example requires ",(0,o.kt)("inlineCode",{parentName:"p"},'"private": true,')," in your ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," and simplifies the workflow to lightning fast deployment:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'release:\n  environment:\n    name: production\n    url: https://github.com/${{ github.repository }}/releases/tag/${{ env.RELEASE_TAG }}\n  name: Semantic release\n  runs-on: ubuntu-latest\n  steps:\n    - name: "\u2601\ufe0f checkout repository"\n      uses: actions/checkout@v2\n      with:\n        fetch-depth: 0\n\n    - name: "\ud83d\udd27 setup node"\n      uses: actions/setup-node@v2.1.5\n      with:\n        node-version: 16\n\n    - name: "\ud83d\udd27 install npm@latest"\n      run: npm i -g npm@latest\n\n    - name: "\ud83d\udce6 install dependencies"\n      uses: bahmutov/npm-install@v1\n\n    - name: "\ud83d\ude80 static app"\n      run: npm run build\n\n    - name: "\ud83d\ude80 release"\n      id: semantic-release\n      uses: docker://ghcr.io/open-sauced/semantic-release-conventional-config:3.0.0\n      env:\n        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n')),(0,o.kt)("h3",{id:"npm-library"},"Npm library"),(0,o.kt)("p",null,"For ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," libraries we need to set the environment URL manually and set a ",(0,o.kt)("inlineCode",{parentName:"p"},"NPM_TOKEN")," environment variable. This also disables docker builds:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'name: "Release"\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  release:\n    environment:\n      name: npm\n      url: https://www.npmjs.com/package/@open-sauced/semantic-release-conventional-config/v/${{ env.RELEASE_VERSION }}\n    name: Semantic release\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: "\ud83d\udd27 setup node"\n        uses: actions/setup-node@v2.1.5\n        with:\n          node-version: 16\n\n      - name: "\ud83d\udd27 install npm@latest"\n        run: npm i -g npm@latest\n\n      - name: "\ud83d\udce6 install dependencies"\n        uses: bahmutov/npm-install@v1\n\n      - name: "\ud83d\ude80 release"\n        id: semantic-release\n        uses: docker://ghcr.io/open-sauced/semantic-release-conventional-config:3.0.0\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}\n')),(0,o.kt)("p",null,"An up-to-date version of the example above is available at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-sauced/semantic-release-conventional-config/blob/main/.github/workflows/release.yml"},"@open-sauced/semantic-release-conventional-config"),"."),(0,o.kt)("h3",{id:"docker-image"},"Docker image"),(0,o.kt)("p",null,"For docker builds it's best to build your node application in parallel with the container and re-use the artifact at a later stage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'name: "Release"\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  docker:\n    name: Build container\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n\n      - name: "\ud83d\udd27 setup buildx"\n        uses: docker/setup-buildx-action@v1\n\n      - name: "\ud83d\udd27 cache docker layers"\n        uses: actions/cache@v2\n        with:\n          path: /tmp/.buildx-cache\n          key: ${{ runner.os }}-buildx-${{ github.sha }}\n          restore-keys: |\n            ${{ runner.os }}-buildx-\n\n      - name: "\ud83d\udd27 docker meta"\n        id: meta\n        uses: docker/metadata-action@v3\n        with:\n          images: ${{ github.repository }}\n          tags: latest\n\n      - name: "\ud83d\udce6 docker build"\n        uses: docker/build-push-action@v2\n        with:\n          context: .\n          tags: ${{ steps.meta.outputs.tags }}\n          labels: ${{ steps.meta.outputs.labels }}\n          outputs: type=docker,dest=/tmp/docker.tar\n          push: false\n          cache-from: type=gha, scope=${{ github.workflow }}\n          cache-to: type=gha, scope=${{ github.workflow }}\n\n      - name: "\ud83d\udcc2 docker artifacts"\n        uses: actions/upload-artifact@v2\n        with:\n          name: docker\n          path: /tmp/docker.tar\n\n  build:\n    name: Build application\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n\n      - name: "\ud83d\udd27 setup node"\n        uses: actions/setup-node@v2.1.5\n        with:\n          node-version: 16\n\n      - name: "\ud83d\udd27 install npm@latest"\n        run: npm i -g npm@latest\n\n      - name: "\ud83d\udce6 install dependencies"\n        uses: bahmutov/npm-install@v1\n\n      - name: "\ud83d\udcca repository visualizer"\n        id: diagram\n        uses: githubocto/repo-visualizer@0.7.1\n        with:\n          excluded_paths: "node_modules,build,.storybook,.netlify,.github,npm-shrinkwap.json"\n          output_file: "public/diagram.svg"\n          should_push: false\n          artifact_name: "diagram"\n\n      - name: "\ud83d\ude80 static app"\n        run: npm run build\n\n      - name: "\ud83d\udcc2 production artifacts"\n        uses: actions/upload-artifact@v2\n        with:\n          name: build\n          path: build\n\n  release:\n    environment:\n      name: production\n      url: https://github.com/${{ github.repository }}/releases/tag/${{ env.RELEASE_TAG }}\n    name: Semantic release\n    needs:\n      - docker\n      - build\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: "\ud83d\udcc2 download docker artifacts"\n        uses: actions/download-artifact@v2\n        with:\n          name: docker\n          path: /tmp\n\n      - name: "\ud83d\udce6 load tag"\n        run: |\n          docker load --input /tmp/docker.tar\n          docker image ls -a\n\n      - name: "\ud83d\udcc2 download build artifacts"\n        uses: actions/download-artifact@v2\n        with:\n          name: build\n          path: /tmp/build\n\n      - name: "\ud83d\ude80 release"\n        id: semantic-release\n        uses: docker://ghcr.io/open-sauced/semantic-release-conventional-config:3.0.0\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n\n  cleanup:\n    name: Cleanup actions\n    needs:\n      - release\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u267b\ufe0f remove build artifacts"\n        uses: geekyeggo/delete-artifact@v1\n        with:\n          name: |\n            build\n            docker\n')),(0,o.kt)("p",null,"An up-to-date version of the example above is available at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-sauced/open-sauced/blob/main/.github/workflows/release.yml"},"open-sauced/open-sauced"),"."),(0,o.kt)("h3",{id:"pre-releases"},"Pre-releases"),(0,o.kt)("p",null,"This workflow requires the creation of ",(0,o.kt)("inlineCode",{parentName:"p"},"alpha")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"beta")," protected branches while templating every commit to be conventional. It does not support squashing without creating extremely complex conflict resolution:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'name: "Release"\n\non:\n  push:\n    branches:\n      - main\n      - beta\n      - alpha\n\njobs:\n  release:\n    environment:\n      name: npm\n      url: https://www.npmjs.com/package/open-sauced-semantic-config-test/v/${{ steps.release.outputs.version }}\n    name: Semantic release\n    runs-on: ubuntu-latest\n    steps:\n      - name: "\u2601\ufe0f checkout repository"\n        uses: actions/checkout@v2\n        with:\n          fetch-depth: 0\n\n      - name: "\ud83d\ude80 release"\n        id: semantic-release\n        uses: docker://ghcr.io/open-sauced/semantic-release-conventional-config:3.0.0\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}\n')),(0,o.kt)("h2",{id:"faq"},"FAQ"),(0,o.kt)("h3",{id:"which-assets-are-pushed-to-git"},"Which assets are pushed to git"),(0,o.kt)("p",null,"The following assets are added to git using ",(0,o.kt)("inlineCode",{parentName:"p"},"@semantic-release/git"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "assets": [\n    "LICENSE",\n    "LICENSE.md",\n    "COPYING",\n    "COPYING.md",\n    "CHANGELOG.md",\n    "package.json",\n    "package-lock.json",\n    "npm-shrinkwrap.json",\n    "public/diagram.svg",\n    "action.yml"\n  ]\n}\n')),(0,o.kt)("h3",{id:"what-is-the-commit-convention"},"What is the commit convention"),(0,o.kt)("p",null,"The following commit rules are enforced by ",(0,o.kt)("inlineCode",{parentName:"p"},"@semantic-release/commit-analyzer"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "preset": "conventionalcommits",\n  "releaseRules": [\n    { "type": "build", "release": "minor" },\n    { "type": "ci", "release": "patch" },\n    { "type": "docs", "release": "minor" },\n    { "type": "style", "release": "patch" },\n    { "type": "refactor", "release": "patch" },\n    { "type": "test", "release": "patch" },\n    { "type": "revert", "release": "patch" },\n    { "type": "chore", "release": false }\n  ],\n  "parserOpts": {\n    "noteKeywords": ["BREAKING CHANGE", "BREAKING CHANGES", "BREAKING"]\n  }\n}\n')),(0,o.kt)("h3",{id:"how-to-enrich-the-static-distribution"},"How to enrich the static distribution"),(0,o.kt)("p",null,"The following assets are packed into the github release download using ",(0,o.kt)("inlineCode",{parentName:"p"},"@semantic-release/github"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "assets": [\n    {\n      "path": "pack/*.tgz",\n      "label": "Static distribution"\n    }\n  ]\n}\n')),(0,o.kt)("h3",{id:"how-to-start-using-pre-releases"},"How to start using pre-releases"),(0,o.kt)("p",null,"Create the ",(0,o.kt)("inlineCode",{parentName:"p"},"alpha")," and/or ",(0,o.kt)("inlineCode",{parentName:"p"},"beta")," branches and protect them from being deleted or pushed to directly by non-administrators."),(0,o.kt)("p",null,"Switch your branching strategy to ",(0,o.kt)("inlineCode",{parentName:"p"},"merge")," and enable conventional commits checking."),(0,o.kt)("p",null,"You will have to resolve merge conflicts between ",(0,o.kt)("inlineCode",{parentName:"p"},"alpha"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"beta")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"main")," branches as described in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/semantic-release/semantic-release/tree/master/docs/recipes"},"semantic-releases recipes"),"."),(0,o.kt)("h2",{id:"contributing"},"Contributing"),(0,o.kt)("p",null,"We're always happy to onboard people into open source!"),(0,o.kt)("p",null,"Check out the repository at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-sauced/semantic-release-conventional-config"},"@open-sauced/semantic-release-conventional-config")," \u2764\ufe0f"))}m.isMDXComponent=!0}}]);